<script>
async function predict() {
  const city = document.getElementById("city").value;
  const date = document.getElementById("startDate").value;
  const days = document.getElementById("days").value;

  document.getElementById("status").innerHTML = "‚è≥ Fetching predictions...";
  try {
    const res = await fetch("/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ city, start_date: date, days })
    });
    const data = await res.json();

    if (data.error) throw new Error(data.error);

    let html = `
      <h2 class="text-2xl font-semibold mb-2">üå°Ô∏è ${data.city} - ${days} Day Forecast</h2>
      <table class="mx-auto text-left border-collapse mt-4">
        <thead>
          <tr class="bg-orange-200">
            <th class="px-4 py-2">Date</th>
            <th class="px-4 py-2">Probability</th>
            <th class="px-4 py-2">Prediction</th>
            <th class="px-4 py-2">Risk Level</th>
          </tr>
        </thead>
        <tbody>
    `;
    data.results.forEach(r => {
      html += `
        <tr class="border-b">
          <td class="px-4 py-2">${r.DATE}</td>
          <td class="px-4 py-2">${(r.Heatwave_Prob * 100).toFixed(1)}%</td>
          <td class="px-4 py-2">${r.Heatwave_Pred === 1 ? "üî• Yes" : "‚ùÑÔ∏è No"}</td>
          <td class="px-4 py-2 font-semibold">${r.Risk_Level}</td>
        </tr>
      `;
    });
    html += "</tbody></table>";
    document.getElementById("status").innerHTML = html;
  } catch (err) {
    document.getElementById("status").innerHTML = "‚ùå Error: " + err.message;
  }
}
</script>
